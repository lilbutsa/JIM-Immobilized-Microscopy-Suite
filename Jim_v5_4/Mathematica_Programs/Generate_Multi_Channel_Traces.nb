(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    103822,       2469]
NotebookOptionsPosition[    100576,       2414]
NotebookOutlinePosition[    100922,       2429]
CellTagsIndexPosition[    100879,       2426]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"GetPlotRange", "::", "usage"}], "=", 
   "\"\<GetPlotRange[gr] returns the actual unpadded plot range of graphics \
gr. GetPlotRange[gr, True] returns the actual padded plot range of gr. \
GetPlotRange can handle Graphics, Graphics3D and Graph objects.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GetPlotRange", "[", 
    RowBox[{
     RowBox[{"_", "[", 
      RowBox[{
       RowBox[{"gr", ":", 
        RowBox[{"(", 
         RowBox[{
         "_Graphics", "|", "_Graphics3D", "|", "_Graph", "|", 
          "_GeoGraphics"}], ")"}]}], ",", "___"}], "]"}], ",", "pad_"}], 
    "]"}], ":=", 
   RowBox[{"GetPlotRange", "[", 
    RowBox[{"gr", ",", "pad"}], "]"}]}], ";", 
  RowBox[{"(*", 
   RowBox[{"Handle", " ", 
    RowBox[{"Legended", "[", "\[Ellipsis]", "]"}], " ", "and", " ", 
    RowBox[{"similar", "."}]}], "*)"}], 
  RowBox[{
   RowBox[{"GetPlotRange", "[", 
    RowBox[{"gr_GeoGraphics", ",", "False"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{"PlotRange", "/.", 
     RowBox[{"Quiet", "@", 
      RowBox[{"AbsoluteOptions", "@", "gr"}]}]}], ")"}]}], ";", 
  RowBox[{"(*", 
   RowBox[{"TODO", ":", 
    RowBox[{"does", " ", "not", " ", "handle", " ", 
     RowBox[{"PlotRangePadding", "."}]}]}], "*)"}], 
  RowBox[{
   RowBox[{"GetPlotRange", "[", 
    RowBox[{"gr_Graph", ",", 
     RowBox[{"pad_:", " ", "False"}]}], "]"}], ":=", 
   RowBox[{"Charting`get2DPlotRange", "[", 
    RowBox[{"gr", ",", "pad"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetPlotRange", "[", 
     RowBox[{
      RowBox[{"gr", ":", 
       RowBox[{"(", 
        RowBox[{"_Graphics", "|", "_Graphics3D"}], ")"}]}], ",", 
      RowBox[{"pad_:", " ", "False"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"r", "=", 
        RowBox[{"PlotRange", "/.", 
         RowBox[{"Options", "@", "gr"}]}]}], "}"}], ",", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"r", ",", "NumericQ"}], "]"}], ",", 
        RowBox[{"(*", 
         RowBox[{"TODO", ":", 
          RowBox[{
          "does", " ", "not", " ", "handle", " ", "PlotRangePadding"}]}], 
         "*)"}], "r", ",", 
        RowBox[{"Last", "@", 
         RowBox[{"Last", "@", 
          RowBox[{"Reap", "@", 
           RowBox[{"Rasterize", "[", 
            RowBox[{
             RowBox[{"Show", "[", 
              RowBox[{"gr", ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"pad", "===", "False"}], ",", 
                 RowBox[{"PlotRangePadding", "\[Rule]", "None"}], ",", 
                 RowBox[{"{", "}"}]}], "]"}], ",", 
               RowBox[{"Axes", "\[Rule]", "True"}], ",", 
               RowBox[{"Frame", "\[Rule]", "False"}], ",", 
               RowBox[{"Ticks", "\[Rule]", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Sow", "@", 
                    RowBox[{"{", "##", "}"}]}], ";", "Automatic"}], ")"}], 
                  "&"}], ")"}]}], ",", 
               RowBox[{"DisplayFunction", "\[Rule]", "Identity"}], ",", 
               RowBox[{"ImageSize", "\[Rule]", "0"}]}], "]"}], ",", 
             RowBox[{"ImageResolution", "\[Rule]", "1"}]}], "]"}]}]}]}]}], 
       "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", "\n", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Joins", " ", "and", " ", "filters", " ", "options"}], ",", 
    RowBox[{
    "keeping", " ", "the", " ", "righmost", " ", "if", " ", "there", " ", 
     "are", " ", "multiple", " ", "instances", " ", "of", " ", "the", " ", 
     "same", " ", 
     RowBox[{"option", "."}]}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"filter", "[", 
     RowBox[{"opts_List", ",", "head_"}], "]"}], ":=", 
    RowBox[{"Reverse", "@", 
     RowBox[{"DeleteDuplicatesBy", "[", 
      RowBox[{
       RowBox[{"Reverse", "@", 
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{"Flatten", "@", "opts"}], ",", 
          RowBox[{"First", "/@", 
           RowBox[{"Options", "@", "head"}]}]}], "]"}]}], ",", "First"}], 
      "]"}]}]}], ";"}], "\[IndentingNewLine]", "\n", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
     "Find", " ", "and", " ", "use", " ", "SETools", " ", "of", " ", 
      "Szabolcs"}], "&"}], " ", "Halirutan"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"$SEToolsExist", "=", 
    RowBox[{"FileExistsQ", "@", 
     RowBox[{"FileNameJoin", "@", 
      RowBox[{"{", 
       RowBox[{
       "$UserBaseDirectory", ",", "\"\<Applications\>\"", ",", 
        "\"\<SETools\>\"", ",", "\"\<Java\>\"", ",", "\"\<SETools.jar\>\""}], 
       "}"}]}]}]}], ";"}], "\n", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"If", " ", "SETools", " ", "exist"}], ",", 
    RowBox[{
    "initiate", " ", "JLink", " ", "and", " ", "include", " ", "some", " ", 
     "functions"}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{"$SEToolsExist", ",", 
     RowBox[{
      RowBox[{"Needs", "@", "\"\<JLink`\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{"JLink`InstallJava", "[", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"copyToClipboard", "[", "text_", "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", "nb", "}"}], ",", 
         RowBox[{
          RowBox[{"nb", "=", 
           RowBox[{"NotebookCreate", "[", 
            RowBox[{"Visible", "\[Rule]", "False"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"NotebookWrite", "[", 
           RowBox[{"nb", ",", 
            RowBox[{"Cell", "[", 
             RowBox[{"text", ",", "\"\<Input\>\""}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"SelectionMove", "[", 
           RowBox[{"nb", ",", "All", ",", "Notebook"}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"FrontEndTokenExecute", "[", 
           RowBox[{"nb", ",", "\"\<Copy\>\""}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"NotebookClose", "@", "nb"}], ";"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"uploadButtonAction", "[", "img_", "]"}], ":=", 
       RowBox[{"uploadButtonAction", "[", 
        RowBox[{
        "img", ",", "\"\<![Mathematica graphics](\>\"", ",", "\"\<)\>\""}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"uploadButtonAction", "[", 
        RowBox[{"img_", ",", "wrapStart_String", ",", "wrapEnd_String"}], 
        "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", "url", "}"}], ",", 
         RowBox[{
          RowBox[{"Check", "[", 
           RowBox[{
            RowBox[{"url", "=", 
             RowBox[{"stackImage", "@", "img"}]}], ",", 
            RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"copyToClipboard", "@", 
           RowBox[{"(", 
            RowBox[{"wrapStart", "<>", "url", "<>", "wrapEnd"}], ")"}]}], 
          ";"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"stackImage", "::", "httperr"}], "=", 
       "\"\<Server returned respose code: `1`\>\""}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"stackImage", "::", "err"}], "=", 
       "\"\<Server returner error: `1`\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"stackImage", "::", "parseErr"}], "=", 
       "\"\<Could not parse the answer of the server.\>\""}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"stackImage", "[", "g_", "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "url", ",", "client", ",", "method", ",", "data", ",", "partSource",
            ",", "part", ",", "entity", ",", "code", ",", "response", ",", 
           "error", ",", "result", ",", "parseXMLOutput"}], "}"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"parseXMLOutput", "[", "str_String", "]"}], ":=", 
           RowBox[{"Block", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"xml", "=", 
                RowBox[{"ImportString", "[", 
                 RowBox[{"str", ",", 
                  RowBox[{"{", 
                   RowBox[{"\"\<HTML\>\"", ",", "\"\<XMLObject\>\""}], 
                   "}"}]}], "]"}]}], ",", "result"}], "}"}], ",", 
             RowBox[{
              RowBox[{"result", "=", 
               RowBox[{
                RowBox[{"Cases", "[", 
                 RowBox[{"xml", ",", 
                  RowBox[{
                   RowBox[{"XMLElement", "[", 
                    RowBox[{"\"\<script\>\"", ",", "_", ",", "res_"}], "]"}], 
                   "\[RuleDelayed]", 
                   RowBox[{"StringTrim", "[", "res", "]"}]}], ",", 
                  "Infinity"}], "]"}], "/.", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"{", "s_String", "}"}], "}"}], "\[RuleDelayed]", 
                 "s"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"result", "=!=", 
                  RowBox[{"{", "}"}]}], "&&", 
                 RowBox[{"StringMatchQ", "[", 
                  RowBox[{"result", ",", 
                   RowBox[{"\"\<window.parent\>\"", "~~", "__"}]}], "]"}]}], 
                ",", 
                RowBox[{"Flatten", "@", 
                 RowBox[{"StringCases", "[", 
                  RowBox[{"result", ",", 
                   RowBox[{
                    RowBox[{
                    "\"\<window.parent.\>\"", "~~", "func__", "~~", 
                    "\"\<(\>\"", "~~", "arg__", "~~", "\"\<);\>\""}], 
                    "\[RuleDelayed]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"StringMatchQ", "[", 
                    RowBox[{"func", ",", "\"\<closeDialog\>\""}], "]"}], ",", 
                    RowBox[{"StringTrim", "[", 
                    RowBox[{"arg", ",", "\"\<\\\"\>\""}], "]"}]}], "}"}]}]}], 
                  "]"}]}], ",", "$Failed"}], "]"}]}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"parseXMLOutput", "[", "___", "]"}], ":=", "$Failed"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"data", "=", 
           RowBox[{"ExportString", "[", 
            RowBox[{"g", ",", "\"\<PNG\>\""}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"JLink`JavaBlock", "[", 
           RowBox[{
            RowBox[{"JLink`LoadJavaClass", "[", 
             RowBox[{"\"\<de.halirutan.se.tools.SEUploader\>\"", ",", 
              RowBox[{"StaticsVisible", "\[Rule]", "True"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"response", "=", 
             RowBox[{"Check", "[", 
              RowBox[{
               RowBox[{"SEUploader`sendImage", "@", 
                RowBox[{"ToCharacterCode", "@", "data"}]}], ",", 
               RowBox[{"Return", "@", "$Failed"}]}], "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"response", "===", "$Failed"}], ",", 
            RowBox[{"Return", "@", "$Failed"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"result", "=", 
           RowBox[{"parseXMLOutput", "@", "response"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"result", "=!=", "$Failed"}], ",", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"TrueQ", "@", 
               RowBox[{"First", "@", "result"}]}], ",", 
              RowBox[{"Last", "@", "result"}], ",", 
              RowBox[{
               RowBox[{"Message", "[", 
                RowBox[{
                 RowBox[{"stackImage", "::", "err"}], ",", 
                 RowBox[{"Last", "@", "result"}]}], "]"}], ";", "$Failed"}]}],
              "]"}], ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"stackImage", "::", "parseErr"}], "]"}], ";", 
             "$Failed"}]}], "]"}]}]}], "]"}]}], ";"}]}], "]"}], ";"}], "\n", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GraphicsButton", "::", "usage"}], "=", 
   "\"\<GraphicsButton[lbl, gr] represent a button that is labeled with lbl \
and offers functionality for the static graphics object gr. \
GraphicsButton[gr] uses a tiny version of gr as label.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MenuItems", "::", "usage"}], "=", 
   "\"\<MenuItems is an option for GraphicsButton that specifies additional \
label \[RuleDelayed] command pairs as a list to be included at the top of the \
action menu of GraphicsButton.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "GraphicsButton", "]"}], "=", 
   RowBox[{"DeleteDuplicatesBy", "[", 
    RowBox[{
     RowBox[{"Flatten", "@", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"MenuItems", "\[Rule]", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"RasterSize", "\[Rule]", "Automatic"}], ",", 
        RowBox[{"ColorSpace", "\[Rule]", "Automatic"}], ",", 
        RowBox[{"ImageResolution", "\[Rule]", "300"}], ",", 
        RowBox[{"Options", "@", "ActionMenu"}]}], "}"}]}], ",", "First"}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GraphicsButton", "[", 
    RowBox[{"expr_", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"GraphicsButton", "[", 
    RowBox[{
     RowBox[{"Pane", "[", 
      RowBox[{"expr", ",", 
       RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
       RowBox[{"ImageSizeAction", "\[Rule]", "\"\<ShrinkToFit\>\""}]}], "]"}],
      ",", "expr", ",", "opts"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GraphicsButton", "[", 
     RowBox[{"lbl_", ",", "expr_", ",", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"head", ",", "save", ",", 
        RowBox[{"items", "=", 
         RowBox[{"OptionValue", "@", "MenuItems"}]}], ",", "rasterizeOpts", 
        ",", 
        RowBox[{"dir", "=", "$UserDocumentsDirectory"}], ",", 
        RowBox[{"file", "=", "\"\<\>\""}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"rasterizeOpts", "=", 
        RowBox[{"filter", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Options", "@", "GraphicsButton"}], ",", "opts"}], "}"}], 
          ",", 
          RowBox[{"Options", "@", "Rasterize"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"save", "[", "format_", "]"}], ":=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"file", "=", 
           RowBox[{"SystemDialogInput", "[", 
            RowBox[{"\"\<FileSave\>\"", ",", 
             RowBox[{"FileNameJoin", "@", 
              RowBox[{"{", 
               RowBox[{"dir", ",", 
                RowBox[{"\"\<.\>\"", "<>", 
                 RowBox[{"ToLowerCase", "@", "format"}]}]}], "}"}]}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"file", "=!=", "$Failed"}], "&&", 
             RowBox[{"file", "=!=", "$Canceled"}]}], ",", 
            RowBox[{
             RowBox[{"dir", "=", 
              RowBox[{"DirectoryName", "@", "file"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Quiet", "@", 
              RowBox[{"Export", "[", 
               RowBox[{"file", ",", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"format", "===", "\"\<NB\>\""}], ",", "expr", ",", 
                  RowBox[{"Rasterize", "[", 
                   RowBox[{
                   "expr", ",", "\"\<Image\>\"", ",", "rasterizeOpts"}], 
                   "]"}]}], "]"}], ",", "format"}], "]"}]}]}]}], "]"}]}], 
         ")"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"head", "=", 
        RowBox[{"Head", "@", 
         RowBox[{"Unevaluated", "@", "expr"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ActionMenu", "[", 
        RowBox[{"lbl", ",", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"items", "=!=", 
               RowBox[{"{", "}"}]}], ",", "items", ",", "Nothing"}], "]"}], 
            ",", 
            RowBox[{"\"\<Copy expression\>\"", "\[RuleDelayed]", 
             RowBox[{"CopyToClipboard", "@", "expr"}]}], ",", 
            RowBox[{"\"\<Copy image\>\"", "\[RuleDelayed]", 
             RowBox[{"CopyToClipboard", "@", 
              RowBox[{"Rasterize", "@", "expr"}]}]}], ",", 
            RowBox[{"\"\<Copy high-res image\>\"", "\[RuleDelayed]", 
             RowBox[{"CopyToClipboard", "@", 
              RowBox[{"Rasterize", "[", 
               RowBox[{"expr", ",", "\"\<Image\>\"", ",", "rasterizeOpts"}], 
               "]"}]}]}], ",", 
            RowBox[{"\"\<Paste expression\>\"", "\[RuleDelayed]", 
             RowBox[{"Paste", "@", "expr"}]}], ",", 
            RowBox[{"\"\<Paste image\>\"", "\[RuleDelayed]", 
             RowBox[{"Paste", "@", 
              RowBox[{"Rasterize", "@", "expr"}]}]}], ",", 
            RowBox[{"\"\<Paste high-res image\>\"", "\[RuleDelayed]", 
             RowBox[{"Paste", "@", 
              RowBox[{"Rasterize", "[", 
               RowBox[{"expr", ",", "\"\<Image\>\"", ",", "rasterizeOpts"}], 
               "]"}]}]}], ",", "Delimiter", ",", 
            RowBox[{"\"\<Save as notebook\[Ellipsis]\>\"", "\[RuleDelayed]", 
             RowBox[{"save", "@", "\"\<NB\>\""}]}], ",", 
            RowBox[{"\"\<Save as JPEG\[Ellipsis]\>\"", "\[RuleDelayed]", 
             RowBox[{"save", "@", "\"\<JPEG\>\""}]}], ",", 
            RowBox[{"\"\<Save as TIFF\[Ellipsis]\>\"", "\[RuleDelayed]", 
             RowBox[{"save", "@", "\"\<TIFF\>\""}]}], ",", 
            RowBox[{"\"\<Save as BMP\[Ellipsis]\>\"", "\[RuleDelayed]", 
             RowBox[{"save", "@", "\"\<BMP\>\""}]}], ",", "Delimiter", ",", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<Upload image to StackExchange\>\"", ",", 
               RowBox[{"If", "[", 
                RowBox[{"$SEToolsExist", ",", "Black", ",", "Gray"}], "]"}]}],
               "]"}], "\[RuleDelayed]", 
             RowBox[{"If", "[", 
              RowBox[{"$SEToolsExist", ",", 
               RowBox[{"uploadButtonAction", "@", 
                RowBox[{"Rasterize", "@", "expr"}]}]}], "]"}]}], ",", 
            RowBox[{
            "\"\<Open image in external application\>\"", "\[RuleDelayed]", 
             RowBox[{"Module", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"f", "=", 
                 RowBox[{"Export", "[", 
                  RowBox[{
                   RowBox[{"FileNameJoin", "@", 
                    RowBox[{"{", 
                    RowBox[{
                    "$TemporaryDirectory", ",", "\"\<temp_img.tiff\>\""}], 
                    "}"}]}], ",", 
                   RowBox[{"Rasterize", "@", "expr"}], ",", "\"\<TIFF\>\""}], 
                  "]"}]}], "}"}], ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"StringQ", "@", "f"}], "&&", 
                  RowBox[{"FileExistsQ", "@", "f"}]}], ",", 
                 RowBox[{"SystemOpen", "@", "f"}]}], "]"}]}], "]"}]}]}], 
           "}"}]}], ",", 
         RowBox[{"filter", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Options", "@", "GraphicsButton"}], ",", "opts", ",", 
             RowBox[{"{", 
              RowBox[{"Method", "\[Rule]", "\"\<Queued\>\""}], "}"}]}], "}"}],
            ",", 
           RowBox[{"Options", "@", "ActionMenu"}]}], "]"}]}], "]"}]}]}], 
     "]"}]}], ";"}], "\n", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotExplorer", "::", "usage"}], "=", 
   "\"\<PlotExplorer[plot] returns a manipulable version of plot. \
PlotExplorer can handle Graph and Graphics objects and plotting functions \
like Plot, LogPlot, ListPlot, DensityPlot, Streamplot, etc. PlotExplorer \
allows the modification of the plot range, image size and aspect ratio. If \
the supplied argument is a full specification of a plotting function holding \
its first argument (e.g. Plot) the result offers functionality to replot the \
function to the modified plot range. PlotExplorer has attribute \
HoldFirst.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"AppearanceFunction", "::", "usage"}], "=", 
   "\"\<AppearanceFunction is an option for PlotExplorer that specifies the \
appearance function of the menu button. Use Automatic for the default \
appearance, Identity to display a classic button or None to omit the menu \
button.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MenuPosition", "::", "usage"}], "=", 
   "\"\<MenuPosition is an option for PlotExplorer that specifies the \
position of the (upper right corner of the) menu button within the graphics \
object.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Attributes", "[", "PlotExplorer", "]"}], "=", 
   RowBox[{"{", "HoldFirst", "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PlotExplorer", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"AppearanceFunction", "\[Rule]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Mouseover", "[", 
           RowBox[{
            RowBox[{"Invisible", "@", "#"}], ",", "#"}], "]"}], "&"}], "@", 
         RowBox[{"Framed", "[", 
          RowBox[{"#", ",", 
           RowBox[{"Background", "\[Rule]", 
            RowBox[{"GrayLevel", "[", 
             RowBox[{".5", ",", ".5"}], "]"}]}], ",", 
           RowBox[{"RoundingRadius", "\[Rule]", "5"}], ",", 
           RowBox[{"FrameStyle", "\[Rule]", "None"}], ",", 
           RowBox[{"Alignment", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"Center", ",", "Center"}], "}"}]}], ",", 
           RowBox[{"BaseStyle", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], 
             "}"}]}]}], "]"}]}], "&"}], ")"}]}], ",", 
     RowBox[{"MenuPosition", "\[Rule]", 
      RowBox[{"Scaled", "@", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}]}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotExplorer", "[", 
    RowBox[{"expr_", ",", 
     RowBox[{"rangeArg_:", " ", "Automatic"}], ",", 
     RowBox[{"sizeArg_:", " ", "Automatic"}], ",", 
     RowBox[{"ratioArg_:", " ", "Automatic"}], ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"plot", "=", "expr"}], ",", 
       RowBox[{"held", "=", 
        RowBox[{"Hold", "@", "expr"}]}], ",", "head", ",", 
       RowBox[{"holdQ", "=", "True"}], ",", 
       RowBox[{"legQ", "=", "False"}], ",", "appearance", ",", "position", 
       ",", 
       RowBox[{"$1Dplots", "=", 
        RowBox[{
        "Plot", "|", "LogPlot", "|", "LogLinearPlot", "|", "LogLogPlot"}]}], 
       ",", 
       RowBox[{"$2Dplots", "=", 
        RowBox[{
        "DensityPlot", "|", "ContourPlot", "|", "RegionPlot", "|", 
         "StreamPlot", "|", "StreamDensityPlot", "|", "VectorPlot", "|", 
         "VectorDensityPlot", "|", "LineIntegralConvolutionPlot", "|", 
         "GeoGraphics"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"head", "=", 
       RowBox[{"held", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "0"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"head", "===", "Symbol"}], ",", 
        RowBox[{
         RowBox[{"holdQ", "=", "False"}], ";", 
         RowBox[{"head", "=", 
          RowBox[{"Head", "@", "expr"}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"head", "===", "Legended"}], ",", 
        RowBox[{
         RowBox[{"legQ", "=", "True"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"holdQ", ",", 
           RowBox[{
            RowBox[{"held", "=", 
             RowBox[{"held", "/.", 
              RowBox[{
               RowBox[{"Legended", "[", 
                RowBox[{"x_", ",", "___"}], "]"}], "\[RuleDelayed]", 
               "x"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"head", "=", 
             RowBox[{"held", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "0"}], "]"}], "]"}]}]}], ",", 
           RowBox[{"head", "=", 
            RowBox[{"Head", "@", 
             RowBox[{"First", "@", "expr"}]}]}]}], "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"holdQ", "=", 
       RowBox[{"holdQ", "&&", 
        RowBox[{"MatchQ", "[", 
         RowBox[{"head", ",", 
          RowBox[{"$1Dplots", "|", "$2Dplots"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", "holdQ"}], ",", 
        RowBox[{
         RowBox[{"legQ", "=", 
          RowBox[{
           RowBox[{"Head", "@", "expr"}], "===", "Legended"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"head", "=", 
          RowBox[{"If", "[", 
           RowBox[{"legQ", ",", 
            RowBox[{"Head", "@", 
             RowBox[{"First", "@", "expr"}]}], ",", 
            RowBox[{"Head", "@", "expr"}]}], "]"}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "@", 
         RowBox[{"MatchQ", "[", 
          RowBox[{"head", ",", 
           RowBox[{
           "$1Dplots", "|", "$2Dplots", "|", "Graphics", "|", "Graph"}]}], 
          "]"}]}], ",", "expr", ",", 
        RowBox[{"DynamicModule", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "dyn", ",", "gr", ",", "leg", ",", "replot", ",", "rescale", ",", 
            "new", ",", "mid", ",", "len", ",", 
            RowBox[{"min", "=", "0.1"}], ",", 
            RowBox[{"f", "=", 
             RowBox[{"{", 
              RowBox[{"1", ",", "1"}], "}"}]}], ",", "set", ",", "d", ",", 
            "epilog", ",", 
            RowBox[{"over", "=", "False"}], ",", "defRange", ",", "range", 
            ",", "size", ",", "ratio", ",", "pt1", ",", 
            RowBox[{"pt1sc", "=", "None"}], ",", 
            RowBox[{"pt2", "=", "None"}], ",", 
            RowBox[{"pt2sc", "=", "None"}], ",", "rect", ",", "button"}], 
           "}"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"gr", ",", "leg"}], "}"}], "=", 
            RowBox[{"If", "[", 
             RowBox[{"legQ", ",", 
              RowBox[{"List", "@@", "plot"}], ",", 
              RowBox[{"{", 
               RowBox[{"plot", ",", "None"}], "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"size", "=", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"sizeArg", "===", "Automatic"}], ",", 
              RowBox[{"Rasterize", "[", 
               RowBox[{"gr", ",", "\"\<RasterSize\>\""}], "]"}], ",", 
              RowBox[{"Setting", "@", "sizeArg"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"defRange", "=", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"rangeArg", "===", "Automatic"}], ",", 
              RowBox[{"GetPlotRange", "[", 
               RowBox[{"gr", ",", "False"}], "]"}], ",", 
              RowBox[{"Setting", "@", "rangeArg"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"ratio", "=", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"ratioArg", "===", "Automatic"}], ",", 
              RowBox[{"Divide", "@@", 
               RowBox[{"Reverse", "@", "size"}]}], ",", 
              RowBox[{"Setting", "@", "ratioArg"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"epilog", "=", 
            RowBox[{"Epilog", "/.", 
             RowBox[{"Quiet", "@", 
              RowBox[{"AbsoluteOptions", "@", "plot"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"gr", "=", "plot"}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"When", " ", "r1", " ", "or", " ", "r2", " ", "is", " ", 
              RowBox[{"e", ".", "g", ".", 
               RowBox[{"{", 
                RowBox[{"1", ",", "1"}], "}"}]}], " ", 
              RowBox[{"(", 
               RowBox[{
               "scale", " ", "region", " ", "has", " ", "zero", " ", 
                "width"}], ")"}]}], ",", 
             RowBox[{
             "EuclideanDistance", " ", "by", " ", "defult", " ", "returns", 
              " ", "Infinity", " ", "which", " ", "is", " ", 
              RowBox[{"fine", "."}]}]}], "*)"}], 
           RowBox[{
            RowBox[{"d", "[", 
             RowBox[{"p1_", ",", "p2_", ",", 
              RowBox[{"{", 
               RowBox[{"r1_", ",", "r2_"}], "}"}]}], "]"}], ":=", 
            RowBox[{"Quiet", "@", 
             RowBox[{"N", "@", 
              RowBox[{"EuclideanDistance", "[", 
               RowBox[{
                RowBox[{"Rescale", "[", 
                 RowBox[{"p1", ",", "r1"}], "]"}], ",", 
                RowBox[{"Rescale", "[", 
                 RowBox[{"p2", ",", "r2"}], "]"}]}], "]"}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"set", "[", "r_", "]"}], ":=", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"range", "=", 
               RowBox[{"new", "=", "r"}]}], ";", 
              RowBox[{"mid", "=", 
               RowBox[{"Mean", "/@", "range"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"len", "=", 
               RowBox[{"Abs", "[", 
                RowBox[{"Subtract", "@@@", "range"}], "]"}]}], ";", 
              RowBox[{"pt1", "=", "None"}], ";", 
              RowBox[{"rect", "=", 
               RowBox[{"{", "}"}]}], ";"}], ")"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"set", "@", "defRange"}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Replace", " ", "plot", " ", "range", " ", "or", " ", "insert", 
             " ", "if", " ", "nonexistent"}], "*)"}], 
           RowBox[{
            RowBox[{"replot", "[", 
             RowBox[{"h_", ",", "hold_", ",", "r_"}], "]"}], ":=", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", "temp", "}"}], ",", 
              RowBox[{"ReleaseHold", "@", 
               RowBox[{"Switch", "[", 
                RowBox[{"h", ",", "$1Dplots", ",", 
                 RowBox[{
                  RowBox[{"temp", "=", 
                   RowBox[{"ReplacePart", "[", 
                    RowBox[{"hold", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2", ",", "2"}], "}"}], "\[Rule]", 
                    RowBox[{"r", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2", ",", "3"}], "}"}], "\[Rule]", 
                    RowBox[{"r", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], "}"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"temp", ",", "PlotRange", ",", "Infinity"}], 
                    "]"}], ",", 
                    RowBox[{"temp", "/.", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"_", "[", 
                    RowBox[{"PlotRange", ",", "_"}], "]"}], "\[Rule]", 
                    RowBox[{"(", 
                    RowBox[{"PlotRange", "\[Rule]", "r"}], ")"}]}], "}"}]}], 
                    ",", 
                    RowBox[{"Insert", "[", 
                    RowBox[{"temp", ",", 
                    RowBox[{"PlotRange", "\[Rule]", "r"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "]"}]}], ",", 
                 "$2Dplots", ",", 
                 RowBox[{
                  RowBox[{"temp", "=", 
                   RowBox[{"ReplacePart", "[", 
                    RowBox[{"hold", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2", ",", "2"}], "}"}], "\[Rule]", 
                    RowBox[{"r", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2", ",", "3"}], "}"}], "\[Rule]", 
                    RowBox[{"r", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "3", ",", "2"}], "}"}], "\[Rule]", 
                    RowBox[{"r", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "3", ",", "3"}], "}"}], "\[Rule]", 
                    RowBox[{"r", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], "}"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"temp", ",", "PlotRange", ",", "Infinity"}], 
                    "]"}], ",", 
                    RowBox[{"temp", "/.", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"_", "[", 
                    RowBox[{"PlotRange", ",", "_"}], "]"}], "\[Rule]", 
                    RowBox[{"(", 
                    RowBox[{"PlotRange", "\[Rule]", "r"}], ")"}]}], "}"}]}], 
                    ",", 
                    RowBox[{"Insert", "[", 
                    RowBox[{"temp", ",", 
                    RowBox[{"PlotRange", "\[Rule]", "r"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "]"}]}], ",", "_",
                  ",", "hold"}], "]"}]}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"rescale", "[", 
             RowBox[{"h_", ",", "hold_", ",", "sc_"}], "]"}], ":=", 
            RowBox[{"ReleaseHold", "@", 
             RowBox[{"Switch", "[", 
              RowBox[{"h", ",", 
               RowBox[{"$1Dplots", "|", "$2Dplots"}], ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"MemberQ", "[", 
                  RowBox[{"hold", ",", "ScalingFunctions", ",", "Infinity"}], 
                  "]"}], ",", 
                 RowBox[{"hold", "/.", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"_", "[", 
                    RowBox[{"ScalingFunctions", ",", "_"}], "]"}], "\[Rule]", 
                    RowBox[{"(", 
                    RowBox[{"ScalingFunctions", "\[Rule]", "sc"}], ")"}]}], 
                   "}"}]}], ",", 
                 RowBox[{"Insert", "[", 
                  RowBox[{"hold", ",", 
                   RowBox[{"ScalingFunctions", "\[Rule]", "sc"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "]"}], ",", "_", 
               ",", "hold"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"appearance", "=", 
            RowBox[{
             RowBox[{"OptionValue", "@", "AppearanceFunction"}], "/.", 
             RowBox[{"{", 
              RowBox[{"Automatic", "\[RuleDelayed]", 
               RowBox[{"(", 
                RowBox[{"AppearanceFunction", "/.", 
                 RowBox[{"Options", "@", "PlotExplorer"}]}], ")"}]}], 
              "}"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"position", "=", 
            RowBox[{
             RowBox[{"OptionValue", "@", "MenuPosition"}], "/.", 
             RowBox[{"Automatic", "\[Rule]", 
              RowBox[{"Scaled", "@", 
               RowBox[{"{", 
                RowBox[{"1", ",", "1"}], "}"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Print", "@", 
              RowBox[{"Column", "@", 
               RowBox[{"{", 
                RowBox[{
                "rangeArg", ",", "sizeArg", ",", "ratioArg", ",", 
                 "appearance", ",", "position"}], "}"}]}]}], ";"}], "*)"}], 
           RowBox[{"button", "=", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"appearance", "===", "None"}], ",", 
              RowBox[{"{", "}"}], ",", 
              RowBox[{"Inset", "[", 
               RowBox[{
                RowBox[{"appearance", "@", 
                 RowBox[{"Dynamic", "@", 
                  RowBox[{"GraphicsButton", "[", 
                   RowBox[{"\"\<Menu\>\"", ",", "dyn", ",", 
                    RowBox[{"Appearance", "\[Rule]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"appearance", "===", "Identity"}], ",", 
                    "Automatic", ",", "None"}], "]"}]}], ",", 
                    RowBox[{"MenuItems", "\[Rule]", 
                    RowBox[{"Flatten", "@", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Row", "@", 
                    RowBox[{"{", 
                    RowBox[{"\"\<Copy PlotRange \[Rule] \>\"", ",", 
                    RowBox[{"TextForm", "/@", "range"}]}], "}"}]}], 
                    "\[RuleDelayed]", 
                    RowBox[{"(", 
                    RowBox[{"CopyToClipboard", "[", 
                    RowBox[{"PlotRange", "\[Rule]", "range"}], "]"}], ")"}]}],
                     ",", 
                    RowBox[{
                    RowBox[{"Row", "@", 
                    RowBox[{"{", 
                    RowBox[{"\"\<Copy ImageSize \[Rule] \>\"", ",", 
                    RowBox[{"InputForm", "@", "size"}]}], "}"}]}], 
                    "\[RuleDelayed]", 
                    RowBox[{"(", 
                    RowBox[{"CopyToClipboard", "[", 
                    RowBox[{"ImageSize", "\[Rule]", "size"}], "]"}], ")"}]}], 
                    ",", 
                    RowBox[{
                    RowBox[{"Row", "@", 
                    RowBox[{"{", 
                    RowBox[{"\"\<Copy AspectRatio \[Rule] \>\"", ",", 
                    RowBox[{"InputForm", "@", "ratio"}]}], "}"}]}], 
                    "\[RuleDelayed]", 
                    RowBox[{"(", 
                    RowBox[{"CopyToClipboard", "[", 
                    RowBox[{"AspectRatio", "\[Rule]", "ratio"}], "]"}], 
                    ")"}]}]}], "}"}], ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"MatchQ", "[", 
                    RowBox[{"head", ",", 
                    RowBox[{"$1Dplots", "|", "$2Dplots"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Delimiter", ",", 
                    RowBox[{
                    "\"\<Replot at current PlotRange\>\"", "\[RuleDelayed]", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"gr", "=", 
                    RowBox[{"replot", "[", 
                    RowBox[{"head", ",", "held", ",", "range"}], "]"}]}], 
                    ";"}], ")"}]}], ",", 
                    RowBox[{"\"\<Linear\>\"", "\[RuleDelayed]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"gr", "=", 
                    RowBox[{"rescale", "[", 
                    RowBox[{"head", ",", "held", ",", 
                    RowBox[{"{", 
                    RowBox[{"Identity", ",", "Identity"}], "}"}]}], "]"}]}], 
                    ";"}], "}"}]}], ",", 
                    RowBox[{"\"\<Log\>\"", "\[RuleDelayed]", 
                    RowBox[{"{", 
                    RowBox[{"gr", "=", 
                    RowBox[{"rescale", "[", 
                    RowBox[{"head", ",", "held", ",", 
                    RowBox[{"{", 
                    RowBox[{"Identity", ",", "\"\<Log\>\""}], "}"}]}], 
                    "]"}]}], "}"}]}], ",", 
                    RowBox[{"\"\<LogLinear\>\"", "\[RuleDelayed]", 
                    RowBox[{"{", 
                    RowBox[{"gr", "=", 
                    RowBox[{"rescale", "[", 
                    RowBox[{"head", ",", "held", ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<Log\>\"", ",", "Identity"}], "}"}]}], 
                    "]"}]}], "}"}]}], ",", 
                    RowBox[{"\"\<LogLog\>\"", "\[RuleDelayed]", 
                    RowBox[{"{", 
                    RowBox[{"gr", "=", 
                    RowBox[{"rescale", "[", 
                    RowBox[{"head", ",", "held", ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<Log\>\"", ",", "\"\<Log\>\""}], "}"}]}], 
                    "]"}]}], "}"}]}]}], "}"}], ",", 
                    RowBox[{"{", "}"}]}], "]"}], ",", "Delimiter"}], 
                    "}"}]}]}]}], "]"}]}]}], ",", "position", ",", 
                RowBox[{"Scaled", "@", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "1"}], "}"}]}], ",", 
                RowBox[{"Background", "\[Rule]", "None"}]}], "]"}]}], "]"}]}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"Deploy", "@", 
            RowBox[{"Pane", "[", 
             RowBox[{
              RowBox[{"EventHandler", "[", 
               RowBox[{
                RowBox[{"Dynamic", "[", 
                 RowBox[{
                  RowBox[{"MouseAppearance", "[", 
                   RowBox[{
                    RowBox[{"Show", "[", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "`dyn`", " ", "is", " ", "kept", " ", "as", " ", "the", 
                    " ", "original", " ", "expression", " ", "with", " ", 
                    "only", " ", "updating", " ", "`range`"}], ",", 
                    RowBox[{"`size`", " ", "and", " ", 
                    RowBox[{"`ratio`", "."}]}]}], "*)"}], 
                    RowBox[{
                    RowBox[{"dyn", "=", 
                    RowBox[{"Show", "[", 
                    RowBox[{"gr", ",", 
                    RowBox[{"PlotRange", "\[Rule]", 
                    RowBox[{"Dynamic", "@", "range"}]}], ",", 
                    RowBox[{"ImageSize", "\[Rule]", 
                    RowBox[{"Dynamic", "@", "size"}]}], ",", 
                    RowBox[{"AspectRatio", "\[Rule]", 
                    RowBox[{"Dynamic", "@", "ratio"}]}]}], "]"}]}], ",", 
                    RowBox[{"Epilog", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"epilog", ",", "button", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"FaceForm", "@", 
                    RowBox[{"{", 
                    RowBox[{"Blue", ",", 
                    RowBox[{"Opacity", "@", ".1"}]}], "}"}]}], ",", 
                    RowBox[{"EdgeForm", "@", 
                    RowBox[{"{", 
                    RowBox[{"Thin", ",", "Dotted", ",", 
                    RowBox[{"Opacity", "@", ".5"}]}], "}"}]}], ",", 
                    RowBox[{"Dynamic", "@", "rect"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Dynamic", "@", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"over", "&&", 
                    RowBox[{"CurrentValue", "@", "\"\<AltKey\>\""}], "&&", 
                    RowBox[{"pt2", "=!=", "None"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Antialiasing", "\[Rule]", "False"}], ",", 
                    RowBox[{"AbsoluteThickness", "@", ".25"}], ",", 
                    RowBox[{"GrayLevel", "[", 
                    RowBox[{".5", ",", ".5"}], "]"}], ",", 
                    RowBox[{"Dashing", "@", 
                    RowBox[{"{", "}"}]}], ",", 
                    RowBox[{"InfiniteLine", "@", 
                    RowBox[{"{", 
                    RowBox[{"pt2", ",", 
                    RowBox[{"pt2", "+", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0"}], "}"}]}]}], "}"}]}], ",", 
                    RowBox[{"InfiniteLine", "@", 
                    RowBox[{"{", 
                    RowBox[{"pt2", ",", 
                    RowBox[{"pt2", "+", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}]}]}], "}"}]}]}], "}"}], ",", 
                    RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], "}"}]}]}], "]"}], 
                    ",", 
                    RowBox[{"Which", "[", 
                    RowBox[{
                    RowBox[{"over", "&&", 
                    RowBox[{"CurrentValue", "@", "\"\<AltKey\>\""}], "&&", 
                    RowBox[{"pt2", "=!=", "None"}]}], ",", 
                    RowBox[{"Graphics", "@", 
                    RowBox[{"{", 
                    RowBox[{"Text", "[", 
                    RowBox[{"pt2", ",", "pt2", ",", 
                    RowBox[{"-", 
                    RowBox[{"{", 
                    RowBox[{"1.1", ",", "1"}], "}"}]}], ",", 
                    RowBox[{"Background", "\[Rule]", 
                    RowBox[{"GrayLevel", "[", 
                    RowBox[{"1", ",", ".7"}], "]"}]}]}], "]"}], "}"}]}], ",", 
                    RowBox[{"CurrentValue", "@", "\"\<ShiftKey\>\""}], ",", 
                    "\"\<LinkHand\>\"", ",", 
                    RowBox[{"CurrentValue", "@", "\"\<ControlKey\>\""}], ",", 
                    "\"\<ZoomView\>\"", ",", "True", ",", "Automatic"}], 
                    "]"}]}], "]"}], ",", 
                  RowBox[{"TrackedSymbols", "\[RuleDelayed]", 
                   RowBox[{"{", "gr", "}"}]}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"\"\<MouseEntered\>\"", "\[RuleDelayed]", 
                   RowBox[{"(", 
                    RowBox[{"over", "=", "True"}], ")"}]}], ",", 
                  RowBox[{"\"\<MouseExited\>\"", "\[RuleDelayed]", 
                   RowBox[{"(", 
                    RowBox[{"over", "=", "False"}], ")"}]}], ",", 
                  RowBox[{"\"\<MouseMoved\>\"", "\[RuleDelayed]", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"pt2", "=", 
                    RowBox[{"MousePosition", "@", "\"\<Graphics\>\""}]}], 
                    ";"}], ")"}]}], ",", 
                  RowBox[{"\"\<MouseClicked\>\"", "\[RuleDelayed]", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CurrentValue", "@", "\"\<MouseClickCount\>\""}], 
                    "\[Equal]", "2"}], ",", 
                    RowBox[{"set", "@", "defRange"}]}], "]"}], ";"}], ")"}]}],
                   ",", 
                  RowBox[{"\"\<MouseDown\>\"", "\[RuleDelayed]", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"pt1", "=", 
                    RowBox[{"MousePosition", "@", "\"\<Graphics\>\""}]}], ";",
                     "\[IndentingNewLine]", 
                    RowBox[{"pt1sc", "=", 
                    RowBox[{
                    "MousePosition", "@", "\"\<GraphicsScaled\>\""}]}], ";"}],
                     ")"}]}], ",", 
                  RowBox[{"\"\<MouseUp\>\"", "\[RuleDelayed]", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CurrentValue", "@", "\"\<ControlKey\>\""}], "&&", 
                    RowBox[{
                    RowBox[{"d", "[", 
                    RowBox[{"pt1", ",", "pt2", ",", "new"}], "]"}], ">", 
                    "min"}]}], ",", 
                    RowBox[{
                    RowBox[{"range", "=", 
                    RowBox[{"Transpose", "@", 
                    RowBox[{"Sort", "@", 
                    RowBox[{"{", 
                    RowBox[{"pt1", ",", "pt2"}], "}"}]}]}]}], ";"}]}], "]"}], 
                    ";", 
                    RowBox[{"set", "@", "range"}], ";"}], ")"}]}], ",", 
                  RowBox[{"\"\<MouseDragged\>\"", "\[RuleDelayed]", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"pt2", "=", 
                    RowBox[{"MousePosition", "@", "\"\<Graphics\>\""}]}], ";",
                     "\[IndentingNewLine]", 
                    RowBox[{"pt2sc", "=", 
                    RowBox[{
                    "MousePosition", "@", "\"\<GraphicsScaled\>\""}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Which", "[", 
                    RowBox[{
                    RowBox[{"CurrentValue", "@", "\"\<ShiftKey\>\""}], ",", 
                    RowBox[{
                    RowBox[{"pt2", "=", 
                    RowBox[{
                    RowBox[{"MapThread", "[", 
                    RowBox[{"Rescale", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"MousePosition", "@", "\"\<GraphicsScaled\>\""}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}]}], "}"}], ",", "new"}], 
                    "}"}]}], "]"}], "-", "pt1"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"range", "=", 
                    RowBox[{"new", "-", "pt2"}]}], ";"}], ",", 
                    RowBox[{"(*", "Panning", "*)"}], 
                    RowBox[{"CurrentValue", "@", "\"\<ControlKey\>\""}], ",", 
                    RowBox[{
                    RowBox[{"rect", "=", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"pt1", "===", "None"}], "||", 
                    RowBox[{"pt2", "===", "None"}]}], ",", 
                    RowBox[{"{", "}"}], ",", 
                    RowBox[{"Rectangle", "[", 
                    RowBox[{"pt1", ",", "pt2"}], "]"}]}], "]"}]}], ";"}], ",", 
                    RowBox[{"(*", 
                    RowBox[{"Zooming", " ", "rectangle"}], "*)"}], "True", 
                    ",", 
                    RowBox[{
                    RowBox[{"f", "=", 
                    RowBox[{"10", "^", 
                    RowBox[{"(", 
                    RowBox[{"pt1sc", "-", "pt2sc"}], ")"}]}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"range", "=", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"mid", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "-", "f"}], ")"}], " ", 
                    RowBox[{"(", 
                    RowBox[{"pt1", "-", "mid"}], ")"}]}]}], ")"}], "+", 
                    RowBox[{
                    RowBox[{"f", "/", "2"}], " ", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "len"}], ",", "len"}], "}"}], 
                    "\[Transpose]"}]}]}]}]}]}], 
                    RowBox[{"(*", 
                    RowBox[{"Zofom", " ", "on", " ", "`pt1`"}], "*)"}], 
                    "]"}]}], ")"}]}]}], "}"}], ",", 
                RowBox[{"PassEventsDown", "\[Rule]", "True"}], ",", 
                RowBox[{"PassEventsUp", "\[Rule]", "True"}]}], "]"}], ",", 
              RowBox[{"Dynamic", "[", 
               RowBox[{"size", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"size", "=", "#"}], ";", "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"CurrentValue", "@", "\"\<ControlKey\>\""}], ",", 
                    RowBox[{"ratio", "=", 
                    RowBox[{"Divide", "@@", 
                    RowBox[{"Reverse", "@", "#"}]}]}]}], "]"}]}], ")"}], 
                 "&"}]}], "]"}], ",", 
              RowBox[{"AppearanceElements", "\[Rule]", "\"\<ResizeArea\>\""}],
               ",", 
              RowBox[{"ImageMargins", "\[Rule]", "0"}], ",", 
              RowBox[{"FrameMargins", "\[Rule]", "0"}]}], "]"}]}]}]}], 
         "]"}]}], "]"}]}]}], "]"}]}], ";"}]}], "Input",
 CellOpen->False,
 InitializationCell->True,
 CellChangeTimes->{{3.755897230352*^9, 
  3.7558972303529997`*^9}},ExpressionUUID->"93d79789-3883-4296-8356-\
934b1a5037e1"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{" ", "1", ")"}], " ", "Select", " ", "the", " ", "input", " ", 
    "tiff", " ", "file"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"FileNameSetter", "[", 
   RowBox[{"Dynamic", "[", "f", "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7554674920178003`*^9, 3.7554675075538*^9}, 
   3.7554676179798*^9, {3.7731027477324004`*^9, 3.7731027520684004`*^9}, {
   3.7731027888604*^9, 
   3.7731028049414005`*^9}},ExpressionUUID->"dd123db6-7f48-414d-b83c-\
372adafcd133"],

Cell[BoxData[
 TemplateBox[{Dynamic[$CellContext`f],"Open",All},
  "FileNameSetterBoxes"]], "Output",
 CellChangeTimes->{
  3.7554674798498*^9},ExpressionUUID->"44989efe-2030-4e60-9d26-81330b3e2556"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{" ", "2", ")"}], " ", "Create", " ", "folder", " ", "for", " ", 
    "results"}], " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"jimPath", " ", "=", " ", 
     RowBox[{
      RowBox[{"FileNameJoin", "[", 
       RowBox[{"Drop", "[", 
        RowBox[{
         RowBox[{"FileNameSplit", "[", 
          RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ",", 
         RowBox[{"-", "1"}]}], "]"}], "]"}], "~~", 
      "\"\<\\\\Jim_Programs\\\\\>\""}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"analysisFolder", " ", "=", " ", 
     RowBox[{
      RowBox[{"FileNameJoin", "[", 
       RowBox[{"Append", "[", 
        RowBox[{
         RowBox[{"Drop", "[", 
          RowBox[{
           RowBox[{"FileNameSplit", "[", "f", "]"}], ",", 
           RowBox[{"-", "1"}]}], "]"}], ",", 
         RowBox[{"FileBaseName", "[", "f", "]"}]}], "]"}], "]"}], "~~", 
      "\"\<\\\\\>\""}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Quiet", "[", 
     RowBox[{"CreateDirectory", "[", "analysisFolder", "]"}], "]"}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.7554673693468*^9, 3.7554674467698*^9}, {
  3.7554675983778*^9, 3.7554676336177998`*^9}, {3.7554678765938*^9, 
  3.7554678853938*^9}, {3.7554680156577997`*^9, 3.7554680319378*^9}, {
  3.755895149373*^9, 3.755895149749*^9}, {3.755915091117*^9, 
  3.755915095469*^9}, {3.7731027555174007`*^9, 
  3.7731028037414007`*^9}},ExpressionUUID->"a12e2f3d-5274-45d5-8f85-\
424c08f4e89e"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{" ", "3", ")"}], " ", "Split", " ", "File", " ", "into", " ", 
    "individual", " ", "channels"}], "*)"}], "\[IndentingNewLine]", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"usemetadatafile", "=", "True"}], ";", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Set", " ", "to", " ", "true", " ", "to", " ", "read", " ", "in", " ", 
      "a", " ", "micromanager", " ", "metadata", " ", "file", " ", "to", " ", 
      "ensure", " ", "the", " ", "tiff", " ", "is", " ", "split", " ", 
      RowBox[{"correctly", ".", "If"}], " ", "this", " ", "is", " ", "not", 
      " ", "used", " ", "the", " ", "program", " ", "assumes", " ", "the", 
      " ", "tiff", " ", "stack", " ", "is", " ", "saved", " ", "in", " ", 
      "order"}], " ", "*)"}], "\n", 
    RowBox[{"numberofchannels", "=", "2"}], ";"}], "\n", 
   "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{"usemetadatafile", ",", 
     RowBox[{
      RowBox[{"metafilename", "=", 
       RowBox[{
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"Append", "[", 
          RowBox[{
           RowBox[{"Drop", "[", 
            RowBox[{
             RowBox[{"FileNameSplit", "[", "f", "]"}], ",", 
             RowBox[{"-", "1"}]}], "]"}], ",", 
           RowBox[{"FileBaseName", "[", "f", "]"}]}], "]"}], "]"}], "~~", 
        "\"\<_metadata.txt\>\""}]}], ";", "\[IndentingNewLine]", "\t", 
      RowBox[{"cmd", " ", "=", " ", 
       RowBox[{
       "jimPath", "~~", "\"\<TIFFChannelSplitter.exe \\\"\>\"", "~~", "f", 
        "~~", "\"\<\\\" \\\"\>\"", "~~", "analysisFolder", "~~", 
        "\"\<Images\\\" -MetadataFile \\\"\>\"", "~~", "metafilename", "~~", 
        "\"\<\\\"\>\""}]}], ";"}], "\[IndentingNewLine]", ",", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"cmd", " ", "=", " ", 
       RowBox[{
       "jimPath", "~~", "\"\<TIFFChannelSplitter.exe \\\"\>\"", "~~", "f", 
        "~~", "\"\<\\\" \\\"\>\"", "~~", "analysisFolder", "~~", 
        "\"\<Images\\\" -NumberOfChannels \>\"", "~~", 
        RowBox[{"ToString", "[", "numberofchannels", "]"}]}]}], ";"}]}], 
    "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Run", "[", "cmd", " ", "]"}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.7731092943054004`*^9, 3.7731093223254004`*^9}, {
  3.7731093547814007`*^9, 3.7731093649094005`*^9}, {3.7731094186454*^9, 
  3.7731094622384005`*^9}, {3.7731095086534004`*^9, 3.7731095106534004`*^9}, {
  3.7731096042944*^9, 
  3.7731097826854005`*^9}},ExpressionUUID->"cf914e1f-cf9f-41ef-81c5-\
08259bf06d36"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{" ", "4", ")"}], " ", "Align", " ", "Channels", " ", "and", " ", 
    "Calculate", " ", "Drifts"}], " ", "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"iterations", "=", "1"}], ";"}], "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{"alignstartframe", "=", "1"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"alignendframe", "=", "4"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cmd", " ", "=", " ", 
     RowBox[{
     "jimPath", "~~", "\"\<Align_Channels.exe \\\"\>\"", "~~", 
      "analysisFolder", "~~", "\"\<Aligned\\\" \\\"\>\"", "~~", "f", "~~", 
      "\"\<\\\" -Start \>\"", "~~", 
      RowBox[{"ToString", "[", "alignstartframe", "]"}], "~~", 
      "\"\< -End \>\"", "~~", 
      RowBox[{"ToString", "[", "alignendframe", "]"}], "~~", 
      "\"\< -Iterations \>\"", "~~", 
      RowBox[{"ToString", "[", "iterations", "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Run", "[", "cmd", " ", "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"initialStackMean", "=", 
     RowBox[{"ImageAdjust", "[", 
      RowBox[{"Import", "[", 
       RowBox[{"analysisFolder", "~~", "\"\<Aligned_initial_mean.tiff\>\""}], 
       "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CreateDialog", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"DynamicImage", "[", 
        RowBox[{"initialStackMean", ",", 
         RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], "}"}], ",", 
      RowBox[{"WindowTitle", "\[Rule]", "\"\<Before Drift Correction\>\""}]}],
      "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"imin", " ", "=", " ", 
     RowBox[{"Import", "[", 
      RowBox[{"analysisFolder", "~~", "\"\<Aligned_final_mean.tiff\>\""}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"finalStackMean", "=", 
     RowBox[{"ImageAdjust", "[", 
      RowBox[{"imin", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"RankedMin", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"ImageData", "[", "imin", "]"}], "]"}], ",", " ", 
           RowBox[{"8", 
            RowBox[{
             RowBox[{"ImageDimensions", "[", "imin", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ",", "Automatic"}], 
        "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CreateDialog", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"DynamicImage", "[", 
        RowBox[{"finalStackMean", ",", 
         RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], "}"}], ",", 
      RowBox[{"WindowTitle", "\[Rule]", "\"\<After Drift Correction\>\""}]}], 
     "]"}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.755895103366*^9, 3.755895104092*^9}, {
   3.7558951582209997`*^9, 3.755895162981*^9}, {3.755895370237*^9, 
   3.755895410245*^9}, {3.755896009005*^9, 3.7558960505959997`*^9}, {
   3.7558960836689997`*^9, 3.755896113564*^9}, {3.755896421837*^9, 
   3.7558964545480003`*^9}, 3.755901745545*^9, {3.755903571685*^9, 
   3.755903576341*^9}, {3.755903758149*^9, 3.755903763109*^9}, {
   3.755903869101*^9, 3.755903869477*^9}, {3.7731027971254005`*^9, 
   3.7731028083414*^9}, 3.7731033839414005`*^9, {3.7731034149834003`*^9, 
   3.7731035846054*^9}, 3.7731040728534*^9, 3.7731041503904004`*^9, 
   3.7731041865834007`*^9, {3.7731045784394007`*^9, 3.7731045906784005`*^9}, {
   3.7731097939494004`*^9, 3.7731098039894004`*^9}, 
   3.7731127433504004`*^9},ExpressionUUID->"5b49cb46-4b7e-45d5-a22b-\
ee7e6943f9fd"],

Cell[CellGroupData[{

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7731125884394007`*^9, 3.7731126840844*^9}, {
  3.7731127524444003`*^9, 
  3.7731128457154007`*^9}},ExpressionUUID->"32729606-1661-47e7-9a47-\
3944dd3007fb"],

Cell[BoxData["\<\"\\\"W:\\\\Boecking\\\\James_Walsh\\\\Jim_v5_3\\\\Example_\
Data\\\\Jim_Test_Array_Example\\\\Images_Channel_1.tiff\\\" \
\\\"W:\\\\Boecking\\\\James_Walsh\\\\Jim_v5_3\\\\Example_Data\\\\Jim_Test_\
Array_Example\\\\Images_Channel_2.tiff\\\" \"\>"], "Output",
 CellChangeTimes->{{3.7731127556664004`*^9, 
  3.7731128364334*^9}},ExpressionUUID->"31a5e86b-2114-4b8c-85b7-4edc5539f410"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"iterations", "=", "3"}], ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"alignstartframe", "=", "20"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"alignendframe", "=", "25"}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"manualalignment", "=", "False"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Manually", " ", "set", " ", "the", " ", "alignment", " ", "between", " ",
      "the", " ", "multiple", " ", "channels"}], ",", 
    RowBox[{
    "If", " ", "set", " ", "to", " ", "false", " ", "the", " ", "program", 
     " ", "will", " ", "try", " ", "to", " ", "automatically", " ", "find", 
     " ", "an", " ", "alignment"}]}], "*)"}], "\n", 
  RowBox[{"rotationangle", "=", 
   RowBox[{"-", "1.19"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"scalingfactor", "=", "1"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"xoffset", "=", 
   RowBox[{"-", "5"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"yoffset", "=", 
    RowBox[{"-", "5"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"allchannelnames", "=", 
   RowBox[{"StringJoin", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
      "\"\<\\\"\>\"", "~~", "analysisFolder", "~~", "\"\<Images_Channel_\>\"",
        "~~", 
       RowBox[{"ToString", "[", "i", "]"}], "~~", "\"\<.tiff\\\" \>\""}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", "2"}], "}"}]}], "]"}], "]"}]}], "\n", 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{"if", " ", "manualalignment"}], "\n", 
 RowBox[{
  RowBox[{"cmd", "=", 
   RowBox[{"[", 
    RowBox[{"JIM", ",", 
     RowBox[{"'", 
      RowBox[{"Align_Channels", ".", "exe"}], " ", 
      RowBox[{"\"\<',workingdir,'Aligned\>\"", "'"}]}], ",", 
     "allchannelnames", ",", 
     RowBox[{"'", "-", 
      RowBox[{"Alignment", "'"}]}], ",", 
     RowBox[{"num2str", 
      RowBox[{"(", "xoffset", ")"}]}], ",", 
     RowBox[{"'", "'"}], ",", 
     RowBox[{"num2str", 
      RowBox[{"(", "yoffset", ")"}]}], ",", 
     RowBox[{"'", "'"}], ",", 
     RowBox[{"num2str", 
      RowBox[{"(", "rotationangle", ")"}]}], ",", 
     RowBox[{"'", "'"}], ",", 
     RowBox[{"num2str", 
      RowBox[{"(", "scalingfactor", ")"}]}], ",", 
     RowBox[{"'", "-", 
      RowBox[{"Start", "'"}]}], ",", 
     RowBox[{"num2str", 
      RowBox[{"(", "alignstartframe", ")"}]}], ",", 
     RowBox[{"'", "-", 
      RowBox[{"End", "'"}]}], ",", 
     RowBox[{"num2str", 
      RowBox[{"(", "alignendframe", ")"}]}], ",", 
     RowBox[{"'", "-", 
      RowBox[{"Iterations", "'"}]}], ",", 
     RowBox[{"num2str", 
      RowBox[{"(", "iterations", ")"}]}]}], "]"}]}], 
  ";"}], "\n", "else", "\n", 
 RowBox[{
  RowBox[{"cmd", "=", 
   RowBox[{"[", 
    RowBox[{"JIM", ",", 
     RowBox[{"'", 
      RowBox[{"Align_Channels", ".", "exe"}], " ", 
      RowBox[{"\"\<',workingdir,'Aligned\>\"", "'"}]}], ",", 
     "allchannelnames", ",", 
     RowBox[{"'", "-", 
      RowBox[{"Start", "'"}]}], ",", 
     RowBox[{"num2str", 
      RowBox[{"(", "alignstartframe", ")"}]}], ",", 
     RowBox[{"'", "-", 
      RowBox[{"End", "'"}]}], ",", 
     RowBox[{"num2str", 
      RowBox[{"(", "alignendframe", ")"}]}], ",", 
     RowBox[{"'", "-", 
      RowBox[{"Iterations", "'"}]}], ",", 
     RowBox[{"num2str", 
      RowBox[{"(", "iterations", ")"}]}]}], "]"}]}], ";"}], "\n", "end", "\n", 
 RowBox[{
  RowBox[{"system", 
   RowBox[{"(", "cmd", ")"}]}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{"%", "view", " ", "alignment", " ", "before"}], "\n", 
 RowBox[{"if", " ", "manualalignment"}], "\n", 
 RowBox[{
  RowBox[{"detectedim", "=", 
   RowBox[{"imread", 
    RowBox[{"(", 
     RowBox[{"[", 
      RowBox[{"workingdir", ",", 
       RowBox[{"'", "Aligned_aligned", "_partial", "_mean", "_", "1.", 
        RowBox[{"tiff", "'"}]}]}], "]"}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"originalim", "=", 
   RowBox[{"imread", 
    RowBox[{"(", 
     RowBox[{"[", 
      RowBox[{"workingdir", ",", 
       RowBox[{"'", "Aligned_aligned", "_partial", "_mean", "_", "2.", 
        RowBox[{"tiff", "'"}]}]}], "]"}], ")"}]}]}], 
  ";"}], "\n", "else", "\n", 
 RowBox[{
  RowBox[{"detectedim", "=", 
   RowBox[{"imread", 
    RowBox[{"(", 
     RowBox[{"[", 
      RowBox[{"workingdir", ",", 
       RowBox[{"'", "Aligned_initial", "_partial", "_mean", "_", "1.", 
        RowBox[{"tiff", "'"}]}]}], "]"}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"originalim", "=", 
   RowBox[{"imread", 
    RowBox[{"(", 
     RowBox[{"[", 
      RowBox[{"workingdir", ",", 
       RowBox[{"'", "Aligned_initial", "_partial", "_mean", "_", "2.", 
        RowBox[{"tiff", "'"}]}]}], "]"}], ")"}]}]}], ";"}], "\n", "end", "\n", 
 RowBox[{
  RowBox[{"detectedim", "=", 
   RowBox[{"imadjust", 
    RowBox[{"(", "detectedim", ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"originalim", "=", 
   RowBox[{"imadjust", 
    RowBox[{"(", "originalim", ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"IMG1", "=", 
   RowBox[{"cat", 
    RowBox[{"(", 
     RowBox[{"3", ",", "originalim", ",", "detectedim", ",", 
      RowBox[{"zeros", 
       RowBox[{"(", 
        RowBox[{"size", 
         RowBox[{"(", "detectedim", ")"}]}], ")"}]}]}], ")"}]}]}], 
  ";"}], "\n", 
 RowBox[{"figure", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"'", 
     RowBox[{"Name", "'"}]}], ",", 
    RowBox[{"'", "Before", " ", "Drift", " ", "Correction", " ", "and", " ", 
     RowBox[{"Alignment", "'"}]}]}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"imshow", 
    RowBox[{"(", "IMG1", ")"}]}], ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{"%", "view", " ", "alignment", " ", "after"}], "\n", 
 RowBox[{
  RowBox[{"detectedim", "=", 
   RowBox[{"imread", 
    RowBox[{"(", 
     RowBox[{"[", 
      RowBox[{"workingdir", ",", 
       RowBox[{"'", "Aligned_aligned", "_full", "_mean", "_", "1.", 
        RowBox[{"tiff", "'"}]}]}], "]"}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"detectedim", "=", 
   RowBox[{"imadjust", 
    RowBox[{"(", "detectedim", ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"originalim", "=", 
   RowBox[{"imread", 
    RowBox[{"(", 
     RowBox[{"[", 
      RowBox[{"workingdir", ",", 
       RowBox[{"'", "Aligned_aligned", "_full", "_mean", "_", "2.", 
        RowBox[{"tiff", "'"}]}]}], "]"}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"originalim", "=", 
   RowBox[{"imadjust", 
    RowBox[{"(", "originalim", ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"IMG1", "=", 
   RowBox[{"cat", 
    RowBox[{"(", 
     RowBox[{"3", ",", "originalim", ",", "detectedim", ",", 
      RowBox[{"zeros", 
       RowBox[{"(", 
        RowBox[{"size", 
         RowBox[{"(", "detectedim", ")"}]}], ")"}]}]}], ")"}]}]}], 
  ";"}], "\n", 
 RowBox[{"figure", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"'", 
     RowBox[{"Name", "'"}]}], ",", 
    RowBox[{"'", "After", " ", "Drift", " ", "Correction", " ", "and", " ", 
     RowBox[{"Alignment", "'"}]}]}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"imshow", 
   RowBox[{"(", "IMG1", ")"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"disp", 
    RowBox[{"(", 
     RowBox[{
     "'", "Alignment", " ", "and", " ", "drift", " ", "correction", " ", 
      RowBox[{"completed", "'"}]}], ")"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.7731125070314007`*^9, 3.7731125720054007`*^9}, {
  3.7731128488054004`*^9, 
  3.7731128527974005`*^9}},ExpressionUUID->"d2121078-6f20-411e-a4b5-\
e89f385de959"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{" ", "4", ")"}], " ", "Make", " ", "a", " ", "SubAverage", " ", 
    "of", " ", "the", " ", "Image", " ", "Stack", " ", "for", " ", 
    "Detection"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"usemaxprojection", "=", "False"}], ";"}], "\n", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"partialstartframe", "=", "1"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"partialendframe", "=", "20"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"projstr", " ", "=", " ", 
     RowBox[{"If", "[", 
      RowBox[{
      "usemaxprojection", ",", "\"\< -MaxProjection\>\"", ",", "\"\<\>\""}], 
      "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"cmd", " ", "=", " ", 
     RowBox[{
     "jimPath", "~~", "\"\<MeanofFrames.exe NULL \\\"\>\"", "~~", 
      "analysisFolder", "~~", "\"\<Aligned_Drifts.csv\\\" \\\"\>\"", "~~", 
      "analysisFolder", "~~", "\"\<Aligned\\\" \\\"\>\"", "~~", "f", "~~", 
      "\"\<\\\" -Start \>\"", "~~", 
      RowBox[{"ToString", "[", "partialstartframe", "]"}], "~~", 
      "\"\< -End \>\"", "~~", 
      RowBox[{"ToString", "[", "partialendframe", "]"}], "~~", "projstr"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Run", "[", "cmd", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"imin", " ", "=", " ", 
     RowBox[{"Import", "[", 
      RowBox[{"analysisFolder", "~~", "\"\<Aligned_Partial_Mean.tiff\>\""}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"finalStackMean", "=", 
     RowBox[{"ImageAdjust", "[", 
      RowBox[{"imin", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"RankedMin", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"ImageData", "[", "imin", "]"}], "]"}], ",", " ", 
           RowBox[{"8", 
            RowBox[{
             RowBox[{"ImageDimensions", "[", "imin", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ",", "Automatic"}], 
        "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CreateDialog", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"DynamicImage", "[", 
        RowBox[{"finalStackMean", ",", 
         RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], "}"}], ",", 
      RowBox[{
      "WindowTitle", "\[Rule]", 
       "\"\<Sub-Average to use for detection\>\""}]}], "]"}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.755902034086*^9, 3.755902214276*^9}, {
   3.7559022462530003`*^9, 3.75590235871*^9}, {3.755902393229*^9, 
   3.755902400085*^9}, {3.755903561533*^9, 3.755903567101*^9}, {
   3.755903965949*^9, 3.755903973941*^9}, 3.755904504297*^9, {
   3.7731030139414005`*^9, 3.7731030148934*^9}, {3.7731038934154005`*^9, 
   3.7731040335254*^9}, 3.7731040700374002`*^9, {3.7731043164294004`*^9, 
   3.7731043605414004`*^9}, {3.7731045522374*^9, 3.7731045522854004`*^9}, {
   3.7731046801024003`*^9, 3.7731046812474003`*^9}, {3.7731047388104005`*^9, 
   3.7731048209894004`*^9}, {3.7731048549734*^9, 3.7731048563494005`*^9}, {
   3.7731049497984004`*^9, 3.7731049507814007`*^9}, 
   3.7731052595254*^9},ExpressionUUID->"215994fb-72fd-4a2c-9bac-34f931f332b1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{" ", "5", ")"}], " ", "Detect", " ", "Particles"}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", "Thresholding", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"cutoff", "=", "0.45"}], ";", 
    RowBox[{"(*", " ", 
     RowBox[{
     "The", " ", "curoff", " ", "for", " ", "the", " ", "initial", " ", 
      "thresholding"}], "*)"}], "\[IndentingNewLine]", "\n", 
    RowBox[{"(*", "Filtering", "*)"}], "\n", 
    RowBox[{"left", "=", "10"}], ";", 
    RowBox[{"(*", 
     RowBox[{
     "Excluded", " ", "particles", " ", "closer", " ", "to", " ", "the", " ", 
      "edge", " ", "than", " ", 
      RowBox[{"this", ".", "Make"}], " ", "sure", " ", "this", " ", "value", 
      " ", "is", " ", "larger", " ", "than", " ", "the", " ", "maximum", " ", 
      RowBox[{"drift", ".", "25"}], " ", "works", " ", "well", " ", "in", " ",
       "most", " ", "cases"}], "*)"}], "\n", 
    RowBox[{"right", "=", "10"}], ";", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Excluded", " ", "particles", " ", "closer", " ", "to", " ", "the", " ", 
      "edge", " ", "than", " ", 
      RowBox[{"this", ".", "Make"}], " ", "sure", " ", "this", " ", "value", 
      " ", "is", " ", "larger", " ", "than", " ", "the", " ", "maximum", " ", 
      RowBox[{"drift", ".", "25"}], " ", "works", " ", "well", " ", "in", " ",
       "most", " ", "cases"}], "*)"}], "\n", 
    RowBox[{"top", "=", "10"}], ";", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Excluded", " ", "particles", " ", "closer", " ", "to", " ", "the", " ", 
      "edge", " ", "than", " ", 
      RowBox[{"this", ".", "Make"}], " ", "sure", " ", "this", " ", "value", 
      " ", "is", " ", "larger", " ", "than", " ", "the", " ", "maximum", " ", 
      RowBox[{"drift", ".", "25"}], " ", "works", " ", "well", " ", "in", " ",
       "most", " ", "cases"}], "*)"}], "\n", 
    RowBox[{"bottom", "=", "10"}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "Excluded", " ", "particles", " ", "closer", " ", "to", " ", "the", " ", 
     "edge", " ", "than", " ", 
     RowBox[{"this", ".", "Make"}], " ", "sure", " ", "this", " ", "value", 
     " ", "is", " ", "larger", " ", "than", " ", "the", " ", "maximum", " ", 
     RowBox[{"drift", ".", "25"}], " ", "works", " ", "well", " ", "in", " ", 
     "most", " ", "cases"}], "*)"}], "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{"mincount", "=", 
     RowBox[{"-", "1"}]}], ";", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Minimum", " ", "number", " ", "of", " ", "pixels", " ", "in", " ", "a", 
      " ", "ROI", " ", "to", " ", "be", " ", "counted", " ", "as", " ", "a", 
      " ", 
      RowBox[{"particle", ".", "Use"}], " ", "this", " ", "to", " ", 
      "exclude", " ", "speckles", " ", "of", " ", "background"}], "*)"}], 
    "\n", 
    RowBox[{"maxcount", "=", "1000000"}], ";", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Maximum", " ", "number", " ", "of", " ", "pixels", " ", "in", " ", "a", 
      " ", "ROI", " ", "to", " ", "be", " ", "counted", " ", "as", " ", "a", 
      " ", 
      RowBox[{"particle", ".", "Use"}], " ", "this", " ", "to", " ", 
      "exclude", " ", "aggregates"}], "*)"}], "\n", "\[IndentingNewLine]", 
    RowBox[{"mineccentricity", "=", 
     RowBox[{"-", "0.1"}]}], ";", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
        "Eccentricity", " ", "of", " ", "best", " ", "fit", " ", "ellipse", 
         " ", "goes", " ", "from", " ", "0", " ", "to", " ", "1"}], "-", 
        "0"}], "=", 
       RowBox[{"Perfect", " ", "Circle"}]}], ",", 
      RowBox[{"1", "=", 
       RowBox[{
        RowBox[{"Line", ".", "Use"}], " ", "the", " ", "Minimum", " ", "to", 
        " ", "exclude", " ", "round", " ", 
        RowBox[{"objects", ".", "Set"}], " ", "it", " ", "to", " ", "any", 
        " ", "negative", " ", "number", " ", "to", " ", "allow", " ", "all", 
        " ", "round", " ", "objects"}]}]}], "*)"}], "\n", 
    RowBox[{"maxeccentricity", "=", "0.4"}], ";", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{
      "Use", " ", "the", " ", "maximum", " ", "to", " ", "exclude", " ", 
       "long"}], ",", 
      RowBox[{"thin", " ", 
       RowBox[{"objects", ".", "Set"}], " ", "it", " ", "to", " ", "a", " ", 
       "value", " ", "above", " ", "1", " ", "to", " ", "include", " ", 
       "long"}], ",", 
      RowBox[{"thin", " ", "objects"}]}], "*)"}], "\n", "\[IndentingNewLine]", 
    RowBox[{"minlength", "=", "0"}], ";", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Minimum", " ", "number", " ", "of", " ", "pixels", " ", "for", " ", 
      "the", " ", "major", " ", "axis", " ", "of", " ", "the", " ", "best", 
      " ", "fit", " ", "ellipse"}], "*)"}], "\n", 
    RowBox[{"maxlength", "=", "10"}], ";", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Maximum", " ", "number", " ", "of", " ", "pixels", " ", "for", " ", 
      "the", " ", "major", " ", "axis", " ", "of", " ", "the", " ", "best", 
      " ", "fit", " ", "ellipse"}], "*)"}], "\n", "\[IndentingNewLine]", 
    RowBox[{"maxDistFromLinear", "=", "10000000"}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
      "Maximum", " ", "distance", " ", "that", " ", "a", " ", "pixel", " ", 
       "can", " ", "diviate", " ", "from", " ", "the", " ", "major", " ", 
       RowBox[{"axis", ".", "displayminmax"}]}], "=", 
      RowBox[{"[", 
       RowBox[{"0", " ", "1"}], "]"}]}], ";", 
     RowBox[{
     "%", " ", "This", " ", "just", " ", "adjusts", " ", "the", " ", 
      "contrast", " ", "in", " ", "the", " ", "displayed", " ", 
      RowBox[{"image", ".", "It"}], " ", "does", " ", "NOT", " ", "effect", 
      " ", "detection"}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cmd", " ", "=", " ", 
     RowBox[{
     "jimPath", "~~", "\"\<Detect_Particles.exe \\\"\>\"", "~~", 
      "analysisFolder", "~~", "\"\<Aligned_Partial_Mean.tiff\\\" \\\"\>\"", "~~",
       "analysisFolder", "~~", "\"\<Detected\\\" -BinarizeCutoff \>\"", "~~", 
      RowBox[{"ToString", "[", "cutoff", "]"}], "~~", "\"\< -minLength \>\"", 
      "~~", 
      RowBox[{"ToString", "[", "minlength", "]"}], "~~", 
      "\"\< -maxLength \>\"", "~~", 
      RowBox[{"ToString", "[", "maxlength", "]"}], "~~", 
      "\"\< -minCount \>\"", "~~", 
      RowBox[{"ToString", "[", "mincount", "]"}], "~~", "\"\< -maxCount \>\"",
       "~~", 
      RowBox[{"ToString", "[", "maxcount", "]"}], "~~", 
      "\"\< -minEccentricity \>\"", "~~", 
      RowBox[{"ToString", "[", "mineccentricity", "]"}], "~~", 
      "\"\< -maxEccentricity \>\"", "~~", 
      RowBox[{"ToString", "[", "maxeccentricity", "]"}], "~~", 
      "\"\< -left \>\"", "~~", 
      RowBox[{"ToString", "[", "left", "]"}], "~~", "\"\< -right \>\"", "~~", 
      RowBox[{"ToString", "[", "right", "]"}], "~~", "\"\< -top \>\"", "~~", 
      RowBox[{"ToString", "[", "top", "]"}], "~~", "\"\< -bottom \>\"", "~~", 
      RowBox[{"ToString", "[", "bottom", "]"}], "~~", 
      "\"\< -maxDistFromLinear \>\"", "~~", 
      RowBox[{"ToString", "[", "maxDistFromLinear", "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Run", "[", "cmd", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"imin", " ", "=", " ", 
     RowBox[{"Import", "[", 
      RowBox[{"analysisFolder", "~~", "\"\<Aligned_Partial_Mean.tiff\>\""}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"origim", "=", 
     RowBox[{"ImageAdjust", "[", 
      RowBox[{"imin", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"RankedMin", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"ImageData", "[", "imin", "]"}], "]"}], ",", " ", 
           RowBox[{"8", 
            RowBox[{
             RowBox[{"ImageDimensions", "[", "imin", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ",", "Automatic"}], 
        "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"thresholded", "=", "  ", 
     RowBox[{"Import", "[", 
      RowBox[{"analysisFolder", "~~", "\"\<Detected_Regions.tif\>\""}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"filtered", "=", "  ", 
     RowBox[{"Import", "[", 
      RowBox[{
      "analysisFolder", "~~", "\"\<Detected_Filtered_Regions.tif\>\""}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CreateDialog", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"DynamicImage", "[", 
        RowBox[{
         RowBox[{"ColorCombine", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"4", "origim"}], ",", 
             RowBox[{"0.5", "thresholded"}], ",", 
             RowBox[{"0.5", "filtered"}]}], "}"}], ",", "\"\<RGB\>\""}], 
          "]"}], ",", 
         RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], "}"}], ",", 
      RowBox[{
      "WindowTitle", "\[Rule]", 
       "\"\<Detected Particles - Red Original Image - White Selected ROIs - \
Green to Yellow->Excluded by filters\>\""}]}], "]"}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.755903093118*^9, 3.7559031334309998`*^9}, {
   3.755903197517*^9, 3.755903252477*^9}, {3.755903299829*^9, 
   3.755903539701*^9}, {3.755903986421*^9, 3.755904072885*^9}, {
   3.755904495157*^9, 3.755904515109*^9}, 3.755904839637*^9, 
   3.755905271429*^9, 3.755905422118*^9, {3.7731030177654004`*^9, 
   3.7731030191014004`*^9}, 3.7731043629974003`*^9, {3.7731051774334*^9, 
   3.7731052518224*^9}, {3.7731053243274*^9, 3.7731053863974004`*^9}, {
   3.7731054238144007`*^9, 3.7731054243184004`*^9}, 3.7731054793984003`*^9, 
   3.7731055289124002`*^9, 
   3.7731065022794003`*^9},ExpressionUUID->"fb46038d-dc1b-4acc-a9f7-\
c449e889117f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{" ", "6", ")"}], " ", "Expand", " ", "Regions"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"expandinnerradius", "=", "4.1"}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "Distance", " ", "to", " ", "dilate", " ", "the", " ", "ROIs", " ", "by", 
     " ", "to", " ", "make", " ", "sure", " ", "all", " ", "flourescence", 
     " ", "from", " ", "the", " ", "ROI", " ", "is", " ", "measured"}], 
    "*)"}], "\n", 
   RowBox[{
    RowBox[{"backgroundradius", "=", "20"}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "Distance", " ", "to", " ", "dilate", " ", "beyond", " ", "the", " ", 
     "ROI", " ", "to", " ", "measure", " ", "the", " ", "local", " ", 
     "background"}], " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{"backgroundinnerradius", "=", "0"}], ";", " ", 
    RowBox[{"(*", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"cmd", " ", "=", " ", 
     RowBox[{
     "jimPath", "~~", "\"\<Expand_Shapes.exe \\\"\>\"", "~~", 
      "analysisFolder", "~~", 
      "\"\<Detected_Filtered_Positions.csv\\\" \\\"\>\"", "~~", 
      "analysisFolder", "~~", "\"\<Detected_Positions.csv\\\" \\\"\>\"", "~~",
       "analysisFolder", "~~", "\"\<Expanded\\\" -boundaryDist \>\"", "~~", 
      RowBox[{"ToString", "[", "expandinnerradius", "]"}], "~~", 
      "\"\< -backgroundDist \>\"", "~~", 
      RowBox[{"ToString", "[", "backgroundradius", "]"}], "~~", 
      "\"\< -backInnerRadius \>\"", "~~", 
      RowBox[{"ToString", "[", "backgroundinnerradius", "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Run", "[", "cmd", "]"}], ";"}], "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{"imin", " ", "=", " ", 
     RowBox[{"Import", "[", 
      RowBox[{"analysisFolder", "~~", "\"\<Aligned_Partial_Mean.tiff\>\""}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"origim", "=", 
     RowBox[{"ImageAdjust", "[", 
      RowBox[{"imin", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"RankedMin", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"ImageData", "[", "imin", "]"}], "]"}], ",", " ", 
           RowBox[{"8", 
            RowBox[{
             RowBox[{"ImageDimensions", "[", "imin", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ",", "Automatic"}], 
        "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"thresholded", "=", "  ", 
     RowBox[{"Import", "[", 
      RowBox[{"analysisFolder", "~~", "\"\<Expanded_ROIs.tif\>\""}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"filtered", "=", "  ", 
     RowBox[{"Import", "[", 
      RowBox[{
      "analysisFolder", "~~", "\"\<Expanded_Background_Regions.tif\>\""}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CreateDialog", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"DynamicImage", "[", 
        RowBox[{
         RowBox[{"ColorCombine", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"4", "origim"}], ",", 
             RowBox[{"0.5", "thresholded"}], ",", 
             RowBox[{"0.5", "filtered"}]}], "}"}], ",", "\"\<RGB\>\""}], 
          "]"}], ",", 
         RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}], "}"}], ",", 
      RowBox[{"WindowTitle", "\[Rule]", "\"\<Partial Mean\>\""}]}], "]"}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.755905038158*^9, 3.755905041492*^9}, {3.755905123495*^9,
    3.755905170477*^9}, {3.7559052114370003`*^9, 3.755905304381*^9}, 
   3.7731055435894003`*^9, {3.7731055857354*^9, 3.7731055905894003`*^9}, {
   3.7731056967604003`*^9, 3.7731057216934004`*^9}, {3.7731057548704004`*^9, 
   3.7731058132534003`*^9}, 3.7731058814074*^9, 
   3.7731059773824005`*^9},ExpressionUUID->"53fc2326-d44a-4928-90ce-\
65de420c4e6b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{" ", "7", ")"}], " ", "Calculate", " ", "Traces"}], " ", "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"cmd", " ", "=", " ", 
     RowBox[{
     "jimPath", "~~", "\"\<Calculate_Traces.exe \\\"\>\"", "~~", "f", "~~", 
      "\"\<\\\" \\\"\>\"", "~~", "analysisFolder", "~~", 
      "\"\<Expanded_ROI_Positions.csv\\\" \\\"\>\"", "~~", "analysisFolder", 
      "~~", "\"\<Expanded_Background_Positions.csv\\\" \\\"\>\"", "~~", 
      "analysisFolder", "~~", "\"\<Channel_1\\\" -Drifts \>\"", "~~", 
      "analysisFolder", "~~", "\"\<Aligned_Drifts.csv\\\"\>\""}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Run", "[", "cmd", "]"}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.75590545596*^9, 3.755905462524*^9}, {3.755905539685*^9, 
   3.7559055633570004`*^9}, {3.7559056104449997`*^9, 3.755905700612*^9}, 
   3.7731055448134003`*^9, {3.7731061461744003`*^9, 3.7731061489654007`*^9}, 
   3.7731062080694003`*^9},ExpressionUUID->"7763fb18-c758-4a08-819d-\
1ddc505a19d0"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.7731027777304*^9, 
  3.7731027783564005`*^9}},ExpressionUUID->"af714e1d-63ed-4fec-8d0c-\
c6d5a643edd0"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Batch", " ", "from", " ", "here"}], "*)"}], "\[IndentingNewLine]",
   "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{" ", "1", ")"}], " ", "Select", " ", "folder", " ", "containing", 
    " ", "all", " ", "image", " ", "stacks"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"FileNameSetter", "[", 
   RowBox[{
    RowBox[{"Dynamic", "[", "folderin", "]"}], ",", "\"\<Directory\>\""}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.755911968494*^9, 3.75591201102*^9}, {3.755912208436*^9, 
  3.755912250165*^9}, {3.7731071026684003`*^9, 
  3.7731071085004005`*^9}},ExpressionUUID->"5149a033-9ba3-46ed-8f30-\
c6fd794babe5"],

Cell[BoxData[
 TemplateBox[{Dynamic[$CellContext`folderin],"Directory",All},
  "FileNameSetterBoxes"]], "Output",
 CellChangeTimes->{{3.755912246533*^9, 
  3.755912250811*^9}},ExpressionUUID->"e8e95ced-df71-4e81-a84d-108ddd7d6043"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{" ", "2", ")"}], " ", "Detect", " ", "Files"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"insubfolders", " ", "=", " ", "True"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"insubfolders", "\[Equal]", "False"}], ",", 
      RowBox[{"files", " ", "=", " ", 
       RowBox[{"FileNames", "[", 
        RowBox[{"folderin", "~~", "\"\<\\\\*.tif*\>\""}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"subfolders", " ", "=", " ", 
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"FileNames", "[", 
           RowBox[{"folderin", "~~", "\"\<\\\\*\>\""}], "]"}], ",", 
          RowBox[{
           RowBox[{"DirectoryQ", "[", "#", "]"}], " ", "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"files", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"FileNames", "[", 
            RowBox[{"#", "~~", "\"\<\\\\*.tif*\>\""}], "]"}], "&"}], "/@", 
          "subfolders"}], "]"}]}]}]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<There are \>\"", "~~", 
      RowBox[{"ToString", "[", 
       RowBox[{"Length", "[", "files", "]"}], "]"}], "~~", 
      "\"\< files to analyse\>\""}], "]"}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.75591396863*^9, 3.755914139948*^9}, {3.755914178613*^9, 
  3.755914239237*^9}, {3.755914358973*^9, 3.75591439602*^9}, {
  3.7731071145174007`*^9, 
  3.7731071232774005`*^9}},ExpressionUUID->"99e7bc76-29f1-4759-991c-\
7b753e53081a"],

Cell[BoxData["\<\"There are 10 files to analyse\"\>"], "Print",
 CellChangeTimes->{
  3.755914396475*^9},ExpressionUUID->"fac10a2a-a392-40a3-9ec0-649bf5f7d667"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{" ", "3", ")"}], " ", "Batch", " ", "Process"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ParallelDo", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Print", "[", "i", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"f", " ", "=", " ", 
        RowBox[{"files", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"analysisFolder", " ", "=", " ", 
        RowBox[{
         RowBox[{"FileNameJoin", "[", 
          RowBox[{"Append", "[", 
           RowBox[{
            RowBox[{"Drop", "[", 
             RowBox[{
              RowBox[{"FileNameSplit", "[", "f", "]"}], ",", 
              RowBox[{"-", "1"}]}], "]"}], ",", 
            RowBox[{"FileBaseName", "[", "f", "]"}]}], "]"}], "]"}], "~~", 
         "\"\<\\\\\>\""}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Quiet", "[", 
        RowBox[{"CreateDirectory", "[", "analysisFolder", "]"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"cmd", " ", "=", " ", 
        RowBox[{
        "jimPath", "~~", "\"\<Align_Channels.exe \\\"\>\"", "~~", 
         "analysisFolder", "~~", "\"\<Aligned\\\" \\\"\>\"", "~~", "f", "~~", 
         "\"\<\\\" -Start \>\"", "~~", 
         RowBox[{"ToString", "[", "alignstartframe", "]"}], "~~", 
         "\"\< -End \>\"", "~~", 
         RowBox[{"ToString", "[", "alignendframe", "]"}], "~~", 
         "\"\< -Iterations \>\"", "~~", 
         RowBox[{"ToString", "[", "iterations", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Run", "[", "cmd", " ", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"cmd", " ", "=", " ", 
        RowBox[{
        "jimPath", "~~", "\"\<MeanofFrames.exe NULL \\\"\>\"", "~~", 
         "analysisFolder", "~~", "\"\<Aligned_Drifts.csv\\\" \\\"\>\"", "~~", 
         "analysisFolder", "~~", "\"\<Aligned\\\" \\\"\>\"", "~~", "f", "~~", 
         "\"\<\\\" -Start \>\"", "~~", 
         RowBox[{"ToString", "[", "partialstartframe", "]"}], "~~", 
         "\"\< -End \>\"", "~~", 
         RowBox[{"ToString", "[", "partialendframe", "]"}], "~~", 
         "projstr"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Run", "[", "cmd", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"cmd", " ", "=", " ", 
        RowBox[{
        "jimPath", "~~", "\"\<Detect_Particles.exe \\\"\>\"", "~~", 
         "analysisFolder", "~~", "\"\<Aligned_Partial_Mean.tiff\\\" \\\"\>\"",
          "~~", "analysisFolder", "~~", 
         "\"\<Detected\\\" -BinarizeCutoff \>\"", "~~", 
         RowBox[{"ToString", "[", "cutoff", "]"}], "~~", 
         "\"\< -minLength \>\"", "~~", 
         RowBox[{"ToString", "[", "minlength", "]"}], "~~", 
         "\"\< -maxLength \>\"", "~~", 
         RowBox[{"ToString", "[", "maxlength", "]"}], "~~", 
         "\"\< -minCount \>\"", "~~", 
         RowBox[{"ToString", "[", "mincount", "]"}], "~~", 
         "\"\< -maxCount \>\"", "~~", 
         RowBox[{"ToString", "[", "maxcount", "]"}], "~~", 
         "\"\< -minEccentricity \>\"", "~~", 
         RowBox[{"ToString", "[", "mineccentricity", "]"}], "~~", 
         "\"\< -maxEccentricity \>\"", "~~", 
         RowBox[{"ToString", "[", "maxeccentricity", "]"}], "~~", 
         "\"\< -left \>\"", "~~", 
         RowBox[{"ToString", "[", "left", "]"}], "~~", "\"\< -right \>\"", "~~", 
         RowBox[{"ToString", "[", "right", "]"}], "~~", "\"\< -top \>\"", "~~", 
         RowBox[{"ToString", "[", "top", "]"}], "~~", "\"\< -bottom \>\"", "~~", 
         RowBox[{"ToString", "[", "bottom", "]"}], "~~", 
         "\"\< -maxDistFromLinear \>\"", "~~", 
         RowBox[{"ToString", "[", "maxDistFromLinear", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Run", "[", "cmd", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"cmd", " ", "=", " ", 
        RowBox[{
        "jimPath", "~~", "\"\<Expand_Shapes.exe \\\"\>\"", "~~", 
         "analysisFolder", "~~", 
         "\"\<Detected_Filtered_Positions.csv\\\" \\\"\>\"", "~~", 
         "analysisFolder", "~~", "\"\<Detected_Positions.csv\\\" \\\"\>\"", "~~",
          "analysisFolder", "~~", "\"\<Expanded\\\" -boundaryDist \>\"", "~~", 
         RowBox[{"ToString", "[", "expandinnerradius", "]"}], "~~", 
         "\"\< -backgroundDist \>\"", "~~", 
         RowBox[{"ToString", "[", "backgroundradius", "]"}], "~~", 
         "\"\< -backInnerRadius \>\"", "~~", 
         RowBox[{"ToString", "[", "backgroundinnerradius", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Run", "[", "cmd", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"cmd", " ", "=", " ", 
        RowBox[{
        "jimPath", "~~", "\"\<Calculate_Traces.exe \\\"\>\"", "~~", "f", 
         "~~", "\"\<\\\" \\\"\>\"", "~~", "analysisFolder", "~~", 
         "\"\<Expanded_ROI_Positions.csv\\\" \\\"\>\"", "~~", 
         "analysisFolder", "~~", 
         "\"\<Expanded_Background_Positions.csv\\\" \\\"\>\"", "~~", 
         "analysisFolder", "~~", "\"\<Channel_1\\\" -Drifts \>\"", "~~", 
         "analysisFolder", "~~", "\"\<Aligned_Drifts.csv\\\"\>\""}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Run", "[", "cmd", "]"}], ";"}], "\[IndentingNewLine]", ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"Length", "[", "files", "]"}]}], "}"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.755914514293*^9, 3.755914577109*^9}, {
  3.7559146954449997`*^9, 3.755914733349*^9}, {3.755914829541*^9, 
  3.755914862901*^9}, {3.7731064099024005`*^9, 3.7731064408944006`*^9}, {
  3.7731065281664004`*^9, 3.7731065482624006`*^9}, {3.7731071272934003`*^9, 
  3.7731071362384005`*^9}},ExpressionUUID->"dcff8af7-d808-41e9-84f0-\
081bafb828fb"],

Cell[CellGroupData[{

Cell[BoxData["1"], "Print",
 ShowCellLabel->True,
 CellChangeTimes->{
  3.755914981361*^9},ExpressionUUID->"84f951d7-8a69-4992-9bb5-4de6630f8a8b"],

Cell[BoxData["3"], "Print",
 ShowCellLabel->True,
 CellChangeTimes->{
  3.755914981382*^9},ExpressionUUID->"e853fb5d-5a0c-4e0c-8df8-2ae3d1f83045"],

Cell[BoxData["5"], "Print",
 ShowCellLabel->True,
 CellChangeTimes->{
  3.7559149814300003`*^9},ExpressionUUID->"7ca601f4-bce1-42c9-aaf1-\
f4934772bd8a"],

Cell[BoxData["6"], "Print",
 ShowCellLabel->True,
 CellChangeTimes->{
  3.755914981523*^9},ExpressionUUID->"00aed149-a2a9-4bcc-a205-8cf99e3a240a"],

Cell[BoxData["7"], "Print",
 ShowCellLabel->True,
 CellChangeTimes->{
  3.7559149815360003`*^9},ExpressionUUID->"8fc1f6d6-10c8-45b1-8447-\
953837c953f9"],

Cell[BoxData["8"], "Print",
 ShowCellLabel->True,
 CellChangeTimes->{
  3.755914981552*^9},ExpressionUUID->"e3341082-b10b-41fa-be0e-59e4c536a3c2"],

Cell[BoxData["9"], "Print",
 ShowCellLabel->True,
 CellChangeTimes->{
  3.755914981565*^9},ExpressionUUID->"56251477-a683-43d3-a1f5-aea82e49e256"],

Cell[BoxData["10"], "Print",
 ShowCellLabel->True,
 CellChangeTimes->{
  3.755914981579*^9},ExpressionUUID->"51dce93e-ad07-42bd-8f0c-62d440ea18f9"],

Cell[BoxData["2"], "Print",
 ShowCellLabel->True,
 CellChangeTimes->{
  3.75591504035*^9},ExpressionUUID->"50ed8685-2a41-49e9-ae37-1ba6329a92b7"],

Cell[BoxData["4"], "Print",
 ShowCellLabel->True,
 CellChangeTimes->{
  3.7559150426070004`*^9},ExpressionUUID->"a8b8f318-f554-40a8-b185-\
ec870c6b43ce"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1904, 998},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"11.2 for Microsoft Windows (64-bit) (September 10, 2017)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 54207, 1253, 19, "Input",ExpressionUUID->"93d79789-3883-4296-8356-934b1a5037e1",
 CellOpen->False,
 InitializationCell->True],
Cell[CellGroupData[{
Cell[54790, 1277, 535, 12, 48, "Input",ExpressionUUID->"dd123db6-7f48-414d-b83c-372adafcd133"],
Cell[55328, 1291, 199, 4, 44, "Output",ExpressionUUID->"44989efe-2030-4e60-9d26-81330b3e2556"]
}, Open  ]],
Cell[55542, 1298, 1566, 39, 105, "Input",ExpressionUUID->"a12e2f3d-5274-45d5-8f85-424c08f4e89e"],
Cell[57111, 1339, 2618, 56, 238, "Input",ExpressionUUID->"cf914e1f-cf9f-41ef-81c5-08259bf06d36"],
Cell[59732, 1397, 3723, 87, 295, "Input",ExpressionUUID->"5b49cb46-4b7e-45d5-a22b-ee7e6943f9fd"],
Cell[CellGroupData[{
Cell[63480, 1488, 205, 4, 28, "Input",ExpressionUUID->"32729606-1661-47e7-9a47-3944dd3007fb"],
Cell[63688, 1494, 399, 5, 32, "Output",ExpressionUUID->"31a5e86b-2114-4b8c-85b7-4edc5539f410"]
}, Open  ]],
Cell[64102, 1502, 7442, 221, 903, "Input",ExpressionUUID->"d2121078-6f20-411e-a4b5-e89f385de959"],
Cell[71547, 1725, 3435, 79, 333, "Input",ExpressionUUID->"215994fb-72fd-4a2c-9bac-34f931f332b1"],
Cell[74985, 1806, 9943, 220, 656, "Input",ExpressionUUID->"fb46038d-dc1b-4acc-a9f7-c449e889117f"],
Cell[84931, 2028, 3990, 96, 276, "Input",ExpressionUUID->"53fc2326-d44a-4928-90ce-65de420c4e6b"],
Cell[88924, 2126, 1098, 23, 105, "Input",ExpressionUUID->"7763fb18-c758-4a08-819d-1ddc505a19d0"],
Cell[90025, 2151, 304, 6, 143, "Input",ExpressionUUID->"af714e1d-63ed-4fec-8d0c-c6d5a643edd0"],
Cell[CellGroupData[{
Cell[90354, 2161, 689, 16, 86, "Input",ExpressionUUID->"5149a033-9ba3-46ed-8f30-c6fd794babe5"],
Cell[91046, 2179, 231, 4, 44, "Output",ExpressionUUID->"e8e95ced-df71-4e81-a84d-108ddd7d6043"]
}, Open  ]],
Cell[CellGroupData[{
Cell[91314, 2188, 1709, 44, 143, "Input",ExpressionUUID->"99e7bc76-29f1-4759-991c-7b753e53081a"],
Cell[93026, 2234, 160, 2, 22, "Print",ExpressionUUID->"fac10a2a-a392-40a3-9ec0-649bf5f7d667"]
}, Open  ]],
Cell[CellGroupData[{
Cell[93223, 2241, 5792, 114, 428, "Input",ExpressionUUID->"dcff8af7-d808-41e9-84f0-081bafb828fb"],
Cell[CellGroupData[{
Cell[99040, 2359, 146, 3, 22, "Print",ExpressionUUID->"84f951d7-8a69-4992-9bb5-4de6630f8a8b"],
Cell[99189, 2364, 146, 3, 22, "Print",ExpressionUUID->"e853fb5d-5a0c-4e0c-8df8-2ae3d1f83045"],
Cell[99338, 2369, 153, 4, 22, "Print",ExpressionUUID->"7ca601f4-bce1-42c9-aaf1-f4934772bd8a"],
Cell[99494, 2375, 146, 3, 22, "Print",ExpressionUUID->"00aed149-a2a9-4bcc-a205-8cf99e3a240a"],
Cell[99643, 2380, 153, 4, 22, "Print",ExpressionUUID->"8fc1f6d6-10c8-45b1-8447-953837c953f9"],
Cell[99799, 2386, 146, 3, 22, "Print",ExpressionUUID->"e3341082-b10b-41fa-be0e-59e4c536a3c2"],
Cell[99948, 2391, 146, 3, 22, "Print",ExpressionUUID->"56251477-a683-43d3-a1f5-aea82e49e256"],
Cell[100097, 2396, 147, 3, 22, "Print",ExpressionUUID->"51dce93e-ad07-42bd-8f0c-62d440ea18f9"],
Cell[100247, 2401, 145, 3, 22, "Print",ExpressionUUID->"50ed8685-2a41-49e9-ae37-1ba6329a92b7"],
Cell[100395, 2406, 153, 4, 22, "Print",ExpressionUUID->"a8b8f318-f554-40a8-b185-ec870c6b43ce"]
}, Open  ]]
}, Open  ]]
}
]
*)

